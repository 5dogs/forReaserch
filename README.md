# 需要関数・消費者余剰推移推定プロジェクト


---
直近todo
.
→
---
## 📋 プロジェクト概要

このプロジェクトは、**需要関数の推定**と**消費者余剰の分析**を行うための経済学的分析ツールです。
時系列データ（加入者数、GDP、価格など）を用いて、回帰分析により需要構造を明らかにします。
→余剰の推移と政策の因果関係を推定する

## 🎯 目的

- 所得弾力性（α）、価格弾力性（β）、政策効果（γ）の推定
- 需要関数の導出：`Q = A * GDP^α * P^β * e^(γ*DD)`
- 消費者余剰（CS）の推移分析
- 各要因（GDP、価格、政策）が需要に与える影響の定量化

## 📁 ファイル構成

### メインスクリプト

#### `main_at.py`
**需要関数の推定と定数項の推移分析**

- **主な処理フロー：**
  1. CSVデータの読み込み（年次データ：加入者数Q、GDP、価格P、ダミー変数DD）
  2. 対数変換：`ln(Q)`, `ln(GDP)`, `ln(P)`
  3. 対数差分の計算：`Δln(Q) = ln(Qt) - ln(Qt-1)` （前年比成長率に相当）
  4. 回帰分析：`Δln(Q) = α*Δln(GDP) + β*Δln(P) + γ*DD + 誤差`
  5. 係数の推定（所得弾力性α、価格弾力性β、政策効果γ）
  6. 需要関数のレベル復元：`Q = A * GDP^α * P^β * e^(γ*DD)`
  7. 定数項A_tの計算と推移のグラフ化

- **出力：**
  - 推定された需要関数の係数
  - 各年の定数項A_tの推移グラフ（基礎的な需要水準の変化）

#### `main_cs.py`
**消費者余剰（CS）の推定と推移分析**

- **主な処理フロー：**
  1. データの対数変換と対数差分の計算
  2. 回帰分析：`ln(Q) = a + b*ln(GDP) + c*ln(P)`
  3. 価格弾力性εの取得
  4. 消費者余剰の近似計算：`CS ≈ (ε / (1 + ε)) × P × Q`
  5. CSの推移グラフの作成

- **出力：**
  - `diff_output.csv`（対数差分データ）
  - 消費者余剰の推移グラフ

### データファイル

- **`sample_demand_regression_data.csv`**: 主要な分析データ
  - Year（年）
  - Q (millions)（加入者数、百万人）
  - GDP (trillion yen)（GDP、兆円）
  - P (thousand yen)（価格、千円）
  - DD（ダミー変数、政策効果を表す 0 or 1）

- **`sample_demand_regression_data2.csv`**: 追加データセット

- **`diff_output.csv`**: 対数差分の計算結果
  - Δln(Q), Δln(GDP), Δln(P)（各変数の前年比変化率）

### 補助フォルダ

- **`test最小二乗法/`**: 最小二乗法の動作確認用テストコード
  - `main.py`: テスト実装
  - `mainold.py`: 旧バージョン
  - `data.csv`: テストデータ

### メモ

- **`memo.text`**: プロジェクトの進捗と今後のタスク管理

## 📊 使用するデータ

### ガソリン税による消費者余剰分析用データ項目（最優先4変数）

| データ項目 | 単位 | 説明 | 需要への影響 | 分析での役割 |
|-----------|------|------|-------------|-------------|
| **Q (liters)** | リットル | ガソリン消費量 | - | 被説明変数（分析の対象） |
| **P (yen/liter)** | 円/リットル | ガソリン小売価格（税込み） | 価格上昇→需要減少 | 価格弾力性の測定 |
| **Tax_rate (%)** | % | ガソリン税率 | 税率上昇→価格上昇→需要減少 | 政策効果の測定 |
| **GDP (trillion yen)** | 兆円 | 名目GDP | 所得増加→需要増加 | 所得弾力性の測定 |

### データ項目の選定理由

#### 🔥 **必須4変数の重要性**

1. **Q (liters) - ガソリン消費量**
   - **理由**: 消費者余剰計算の被説明変数
   - **役割**: 需要の変化を直接測定

2. **P (yen/liter) - ガソリン価格**
   - **理由**: 価格弾力性の推定に必要
   - **役割**: 価格変化が需要に与える影響を定量化

3. **Tax_rate (%) - ガソリン税率**
   - **理由**: 政策変数として税制効果を測定
   - **役割**: 税制変更が消費者余剰に与える影響を分析

4. **GDP (trillion yen) - GDP**
   - **理由**: 所得効果の測定に必要
   - **役割**: 経済成長が需要に与える影響を定量化

### 需要関数の推定式

```
⊿lnQ = α×⊿lnGDP + β×⊿lnP + γ×⊿lnTax_rate + ε
```

- **α**: 所得弾力性（GDPの影響）
- **β**: 価格弾力性（価格の影響）
- **γ**: 税率弾力性（税制の影響）

## 🔬 分析フローと結果解釈

### 分析の全体フロー

```
データ準備 → 需要関数推定 → 消費者余剰計算 → 結果解釈 → 政策提言
    ↓           ↓              ↓            ↓         ↓
4変数データ   回帰分析        台形近似計算   統計的解釈   政策効果評価
```

### 1. データ準備段階

#### **使用データ**
- **Q (liters)**: ガソリン消費量（被説明変数）
- **P (yen/liter)**: ガソリン価格（主要説明変数）
- **Tax_rate (%)**: ガソリン税率（政策変数）
- **GDP (trillion yen)**: GDP（所得効果変数）

#### **データ期間**
- **2004年〜2023年（20年分）**
- リーマンショック（2008年）、コロナ（2020年）を含む

### 2. 需要関数推定段階

#### **推定式**
```
⊿lnQ = α×⊿lnGDP + β×⊿lnP + γ×⊿lnTax_rate + ε
```

#### **出力結果の解釈**

| 係数 | 推定値 | 意味 | 解釈 |
|------|--------|------|------|
| **所得弾力性 (α)** | 0.5608 | GDPが1%増加→消費量0.56%増加 | 所得効果は中程度 |
| **価格弾力性 (β)** | 0.0019 | 価格1%上昇→消費量0.002%増加 | 価格非弾力的（必需品） |
| **税率弾力性 (γ)** | 0.0000 | 税率変化→消費量変化なし | 全期間同じ税率のため |

#### **統計的有意性**
- **R² = 0.259**: モデルは需要変化の約26%を説明
- **F統計量 = 2.963, P値 = 0.0787**: モデル全体は10%水準で有意
- **所得弾力性のP値 = 0.093**: 10%水準で有意

### 3. 消費者余剰計算段階

#### **計算手法（測定方法総論に基づく）**
1. **価格要因の寄与率計算**: `Xt+1 = β(exp(lnPt+1－lnPt)－1)／(exp(lnQt+1－lnQt)－1)`
2. **需要増加分の価格要因部分**: `Yt+1 = Xt+1 × (Qt+1－Qt)`
3. **消費者余剰増分の台形面積**: `(Qt＋Qt＋Yt+1)×(Pt－Pt+1)×1/2`

#### **出力結果の解釈**

| 指標 | 値 | 意味 | 解釈 |
|------|----|----|------|
| **総消費者余剰増分** | -3,755.81 | 20年間の累積変化 | 価格上昇により余剰減少 |
| **平均年間余剰増分** | -197.67 | 年間平均変化 | 毎年約200単位の余剰減少 |
| **価格上昇年数** | 17年/20年 | 価格上昇の頻度 | 85%の年で価格上昇 |
| **価格-余剰相関** | -0.2667 | 価格と余剰の関係 | 弱い負の相関 |

### 4. グラフ分析段階

#### **5つのグラフとその解釈**

| グラフ名 | 英語タイトル | 解釈のポイント |
|----------|-------------|---------------|
| **価格推移** | Gasoline Price Trend | 価格上昇傾向、経済ショック時の変動 |
| **消費量推移** | Gasoline Consumption Trend | 消費量の安定性、ショック時の減少 |
| **余剰増分推移** | Consumer Surplus Increase Trend | 年次の余剰変化、価格上昇年の減少 |
| **累積余剰推移** | Cumulative Consumer Surplus Trend | 長期的な余剰変化、政策効果の持続性 |
| **価格-余剰関係** | Gasoline Price vs Consumer Surplus Relationship | 価格と余剰の散布図、相関の可視化 |

### 5. 政策含意と考察

#### **主要な発見**
1. **価格非弾力性**: ガソリンは必需品であり、価格変化に反応しにくい
2. **所得効果**: GDP成長が消費量増加に寄与
3. **消費者余剰の減少**: 価格上昇により長期的に余剰が減少
4. **政策効果の限界**: 税率固定により税制効果を測定できず

#### **政策提言**
1. **価格安定化**: 価格変動の抑制により消費者余剰を保護
2. **代替エネルギー促進**: 価格非弾力性を考慮した政策設計
3. **所得政策**: GDP成長による需要増加効果の活用

## 📊 分析手法の詳細

### 1. 対数変換の意義

```
なぜ対数を取るのか？
→ 経済学では変化率を扱いたいときに「対数の差」を使うのが一般的
→ ln(Q2) - ln(Q1) ≒ (Q2 - Q1) / Q1（≒成長率）
→ 単位の異なるデータ（Q: 百万人, GDP: 兆円）を比較可能にする
```

### 2. 回帰モデル

**変化率モデル：**
```
Δln(Q) = α * Δln(GDP) + β * Δln(P) + γ * DD + ε
```

**レベルモデル（復元後）：**
```
Q = A * GDP^α * P^β * e^(γ*DD)
```

### 3. 定数項A_tの意味

```
A_t = Q / (GDP^α * P^β * exp(γ*DD))
```

- GDP、価格、政策の影響を除いた「純粋な需要水準」
- 年ごとのA_tの推移を見ることで、外的要因を除いた基礎的な需要トレンドを把握

### 4. 消費者余剰の近似

価格弾力性εを用いた近似式：
```
CS ≈ (ε / (1 + ε)) × P × Q
```

## 📈 現状の成果

### ✅ 推定済みの指標

- **所得弾力性（α）**: GDPが1%増加したときのQ（加入者数）の変化率
- **価格弾力性（β）**: 価格が1%上昇したときのQの変化率
- **ダミー変数効果（γ）**: 政策実施による需要への影響
- **需要関数**: 上記係数を組み込んだ完全な需要関数
- **定数項の推移グラフ**: 経済要因を除いた純需要の時系列変化
- **消費者余剰の推移グラフ**: 年次ごとのCS変化

## 🔧 今後のタスク（memo.textより）

### 優先度：高

1. **消費者余剰の要因分解**
   - GDPによる増加分の算出 → グラフ・表化
   - 政策①による増加分の算出 → グラフ・表化
   - 各要因の寄与度を定量的に示す

### 優先度：中

2. **回帰分析の妥当性検証**
   - 手計算による回帰係数の再現
   - 分析手法の理論的理解の深化
   - 統計的有意性の確認（P値、R²など）

3. **説明変数の拡張検討**
   - 現在のモデルで考慮されていない要因の洗い出し
   - 追加変数候補のリストアップ
   - モデルの改善可能性の検討

## 🚀 使い方

### 必要なライブラリ

```bash
pip install pandas numpy matplotlib statsmodels
```

### 実行方法

#### 需要関数の推定
```bash
python main_at.py
```

#### 消費者余剰の分析
```bash
python main_cs.py
```

## 📚 技術スタック

- **Python 3.x**
- **pandas**: データ処理
- **numpy**: 数値計算
- **matplotlib**: グラフ描画
- **statsmodels**: 回帰分析（OLS: Ordinary Least Squares）

## 📝 注意事項

- 分析データのファイルパスは各自の環境に合わせて変更してください
- 対数差分により最初の年（1行目）のデータは除外されます
- ダミー変数DDは1994-96年の政策期間を想定（値は0または1）

## 次回の課題

このプロジェクトは経済学における**需要分析**の標準的手法を実装しています：

- 

---

**作成日**: 2025年10月8日  
**分析対象期間**: 2011年〜2019年  
**プロジェクトステータス**: 進行中 🚧


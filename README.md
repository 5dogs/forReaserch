# 需要関数・消費者余剰推移推定プロジェクト

## 📋 プロジェクト概要

このプロジェクトは、**需要関数の推定**と**消費者余剰の分析**を行うための経済学的分析ツールです。
時系列データ（加入者数、GDP、価格など）を用いて、回帰分析により需要構造を明らかにします。
→余剰の推移と政策の因果関係を推定する

## 🎯 目的

- 所得弾力性（α）、価格弾力性（β）、政策効果（γ）の推定
- 需要関数の導出：`Q = A * GDP^α * P^β * e^(γ*DD)`
- 消費者余剰（CS）の推移分析
- 各要因（GDP、価格、政策）が需要に与える影響の定量化

## 📁 ファイル構成

### メインスクリプト

#### `main_at.py`
**需要関数の推定と定数項の推移分析**

- **主な処理フロー：**
  1. CSVデータの読み込み（年次データ：加入者数Q、GDP、価格P、ダミー変数DD）
  2. 対数変換：`ln(Q)`, `ln(GDP)`, `ln(P)`
  3. 対数差分の計算：`Δln(Q) = ln(Qt) - ln(Qt-1)` （前年比成長率に相当）
  4. 回帰分析：`Δln(Q) = α*Δln(GDP) + β*Δln(P) + γ*DD + 誤差`
  5. 係数の推定（所得弾力性α、価格弾力性β、政策効果γ）
  6. 需要関数のレベル復元：`Q = A * GDP^α * P^β * e^(γ*DD)`
  7. 定数項A_tの計算と推移のグラフ化

- **出力：**
  - 推定された需要関数の係数
  - 各年の定数項A_tの推移グラフ（基礎的な需要水準の変化）

#### `main_cs.py`
**消費者余剰（CS）の推定と推移分析**

- **主な処理フロー：**
  1. データの対数変換と対数差分の計算
  2. 回帰分析：`ln(Q) = a + b*ln(GDP) + c*ln(P)`
  3. 価格弾力性εの取得
  4. 消費者余剰の近似計算：`CS ≈ (ε / (1 + ε)) × P × Q`
  5. CSの推移グラフの作成

- **出力：**
  - `diff_output.csv`（対数差分データ）
  - 消費者余剰の推移グラフ

### データファイル

- **`sample_demand_regression_data.csv`**: 主要な分析データ
  - Year（年）
  - Q (millions)（加入者数、百万人）
  - GDP (trillion yen)（GDP、兆円）
  - P (thousand yen)（価格、千円）
  - DD（ダミー変数、政策効果を表す 0 or 1）

- **`sample_demand_regression_data2.csv`**: 追加データセット

- **`diff_output.csv`**: 対数差分の計算結果
  - Δln(Q), Δln(GDP), Δln(P)（各変数の前年比変化率）

### 補助フォルダ

- **`test最小二乗法/`**: 最小二乗法の動作確認用テストコード
  - `main.py`: テスト実装
  - `mainold.py`: 旧バージョン
  - `data.csv`: テストデータ

### メモ

- **`memo.text`**: プロジェクトの進捗と今後のタスク管理

## 📊 分析手法の詳細

### 1. 対数変換の意義

```
なぜ対数を取るのか？
→ 経済学では変化率を扱いたいときに「対数の差」を使うのが一般的
→ ln(Q2) - ln(Q1) ≒ (Q2 - Q1) / Q1（≒成長率）
→ 単位の異なるデータ（Q: 百万人, GDP: 兆円）を比較可能にする
```

### 2. 回帰モデル

**変化率モデル：**
```
Δln(Q) = α * Δln(GDP) + β * Δln(P) + γ * DD + ε
```

**レベルモデル（復元後）：**
```
Q = A * GDP^α * P^β * e^(γ*DD)
```

### 3. 定数項A_tの意味

```
A_t = Q / (GDP^α * P^β * exp(γ*DD))
```

- GDP、価格、政策の影響を除いた「純粋な需要水準」
- 年ごとのA_tの推移を見ることで、外的要因を除いた基礎的な需要トレンドを把握

### 4. 消費者余剰の近似

価格弾力性εを用いた近似式：
```
CS ≈ (ε / (1 + ε)) × P × Q
```

## 📈 現状の成果

### ✅ 推定済みの指標

- **所得弾力性（α）**: GDPが1%増加したときのQ（加入者数）の変化率
- **価格弾力性（β）**: 価格が1%上昇したときのQの変化率
- **ダミー変数効果（γ）**: 政策実施による需要への影響
- **需要関数**: 上記係数を組み込んだ完全な需要関数
- **定数項の推移グラフ**: 経済要因を除いた純需要の時系列変化
- **消費者余剰の推移グラフ**: 年次ごとのCS変化

## 🔧 今後のタスク（memo.textより）

### 優先度：高

1. **消費者余剰の要因分解**
   - GDPによる増加分の算出 → グラフ・表化
   - 政策①による増加分の算出 → グラフ・表化
   - 各要因の寄与度を定量的に示す

### 優先度：中

2. **回帰分析の妥当性検証**
   - 手計算による回帰係数の再現
   - 分析手法の理論的理解の深化
   - 統計的有意性の確認（P値、R²など）

3. **説明変数の拡張検討**
   - 現在のモデルで考慮されていない要因の洗い出し
   - 追加変数候補のリストアップ
   - モデルの改善可能性の検討

## 🚀 使い方

### 必要なライブラリ

```bash
pip install pandas numpy matplotlib statsmodels
```

### 実行方法

#### 需要関数の推定
```bash
python main_at.py
```

#### 消費者余剰の分析
```bash
python main_cs.py
```

## 📚 技術スタック

- **Python 3.x**
- **pandas**: データ処理
- **numpy**: 数値計算
- **matplotlib**: グラフ描画
- **statsmodels**: 回帰分析（OLS: Ordinary Least Squares）

## 📝 注意事項

- 分析データのファイルパスは各自の環境に合わせて変更してください
- 対数差分により最初の年（1行目）のデータは除外されます
- ダミー変数DDは1994-96年の政策期間を想定（値は0または1）

## 次回の課題

このプロジェクトは経済学における**需要分析**の標準的手法を実装しています：

- 

---

**作成日**: 2025年10月8日  
**分析対象期間**: 2011年〜2019年  
**プロジェクトステータス**: 進行中 🚧


# ガソリン税による消費者余剰分析プロジェクト

## 📋 プロジェクト概要

このプロジェクトは、**ガソリン税による消費者余剰への影響**を分析するための経済学的分析ツールです。
過去20年分の時系列データ（ガソリン消費量、価格、税率、GDP）を用いて、回帰分析により需要構造を明らかにし、消費者余剰の変化を定量化します。

## 🎯 目的

- **ガソリン需要の弾力性推定**: 所得弾力性（α）、価格弾力性（β）、税率弾力性（γ）
- **需要関数の導出**: `⊿lnQ = α×⊿lnGDP + β×⊿lnP + γ×⊿lnTax_rate + ε`  
  ガソリン需要の変化率（左辺）が、GDP・価格・税率のそれぞれの変化率（右辺）にどれだけ反応するかを係数α, β, γで表した対数差分モデル。例えばβは価格が1%変化したときに需要が何%動くかを示す価格弾力性で、εはモデルで説明できないその他の要因。
- **消費者余剰の定量化**: ガソリン税による消費者余剰の変化を測定（測定方法総論に基づく台形近似）
- **政策効果の評価**: 価格変動が消費者余剰に与える影響の分析

## 📁 ファイル構成

###ガソリン税率変遷まとめ
ガソリン税とは、ガソリンに課される税金で、1950年に道路整備の財源確保のために揮発油税・地方揮発油税が導入されました。
ガソリンの暫定税率は1974年に臨時措置としてスタート
→具体的には、揮発油税に対して24.3円、地方揮発油税に対して0.8円が上乗せされ、合計で1リットルあたり25.1円が追加で課税されています。
2009年には道路特定財源制度廃止に伴い一般財源化され、2010 年には名称も「当分の間税率」へと変わったものの、実質的な税率は維持されてきた。
2008年の「ガソリン国会」では暫定税率一時失効による価格乱高下が起こり、政治的混乱の一因となった。2010年にはトリガー条項が創設されたが、2011年に震災対応で凍結されており、現在まで発動されたことはない。

**詳細な四半期ごとのデータ**: `data/-2025ガソリン関連税四半期ごと/gasoline_tax_quarterly.csv`  
（1950年Q1から2025年Q4まで、四半期ごとの税率変遷データを収録）

#### 参考文献・ソース
- **第一生命経済研究所（2021）**: 「暫定税率とはなにか -歴史的経緯と今後の課題- ～ガソリン暫定税率を巡る50年の攻防～」新家義貴  
  https://www.dlri.co.jp/report/macro/495361.html
- **Wikipedia**: 「ガソリン税」「揮発油税」「道路特定財源制度」「トリガー条項」  
  https://ja.wikipedia.org/wiki/ガソリン税  
  https://ja.wikipedia.org/wiki/揮発油税  
  https://ja.wikipedia.org/wiki/道路特定財源制度  
  https://ja.wikipedia.org/wiki/トリガー条項
- **国土交通省**: 「道路特定財源の一般財源化について」  
  https://www.mlit.go.jp/road/ir/ir-funds/minaoshi.html
- **財務省・国税庁**: 揮発油税・地方揮発油税に関する税制資料
- **各種解説記事**: 
  - freee会計ソフト「ガソリン税とは？暫定税率廃止に向けた動きや消費税についても解説」  
    https://www.freee.co.jp/kb/kb-trend/gasoline-tax/
  - TBS CROSS DIG「延長され続ける"ガソリン暫定税率" 50年の攻防」  
    https://newsdig.tbs.co.jp/articles/withbloomberg/2107244

###仕様元データと参照元
四半期別GDP速報
https://www.esri.cao.go.jp/jp/sna/sokuhou/sokuhou_top.html



### メインスクリプト

#### `analysis/01_estimate_demand_function_annual_level_model.py`
**需要関数の推定（年次データ・レベルモデル版）**

- **主な処理フロー：**
  1. 年次データの読み込み（`analysis/demand_regression_data_annual_log_transformed.csv`）
  2. 需要関数の推定：`ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + γ×ln(Tax_rate) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε`
  3. 回帰分析結果の出力（R²=93.9%、先行研究の95%に近い）

- **出力：**
  - `analysis/results/01_coefficients_annual_level_model.json` - 係数と統計指標
  - `analysis/results/01_analysis_data_annual_level_model.csv` - 分析用データ
  - `analysis/results/01_demand_function_coefficients_annual_level_model.csv` - 係数結果

#### `analysis/02_calculate_consumer_surplus.py`
**消費者余剰の計算**

- 測定方法総論に基づく台形近似による消費者余剰の計算
- 出力：`analysis/results/02_consumer_surplus_results.csv`

#### `analysis/03_visualize_results.py`
**分析結果の可視化**

- 5つの研究用グラフ（英語、PNG形式、300dpi）を作成
- 出力：`analysis/figures/`に5つのグラフ

### データファイル

- **`demand_regression_data_raw.csv`**: 元データ（四半期データ、2007Q1-2025Q1）
  - Year, Quarter, Q (liters), P (yen/liter), Tax_rate (%), GDP (trillion yen)
- **`demand_regression_data_annual.csv`**: 年次データ（2007-2025）
  - 四半期データから集約した年次データ
- **`analysis/demand_regression_data_annual_log_transformed.csv`**: 年次データの対数変換版
  - 分析に使用する前処理済みデータ

### 参考資料

- **`消費者余剰測定方法まとめ/`**: 消費者余剰測定の理論的基礎
  - `測定方法総論.text`: 基本的な測定手法
  - `測定方法_金融.text`: 金融分野での応用例
  - イメージ図ファイル: 消費者余剰の概念図

### プロジェクトメモ

- **`project/学士論文メモ.text`**: 学士論文のメモ（最新結果含む）
- **`project/学士論文目次.text`**: 論文の目次構成

## 📊 使用するデータ

### ガソリン税による消費者余剰分析用データ項目（最優先4変数）

| データ項目 | 単位 | 説明 | 需要への影響 | 分析での役割 |
|-----------|------|------|-------------|-------------|
| **Q (liters)** | リットル | ガソリン消費量 | - | 被説明変数（分析の対象） |
| **P (yen/liter)** | 円/リットル | ガソリン小売価格（税込み） | 価格上昇→需要減少 | 価格弾力性の測定 |
| **Tax_rate (%)** | % | ガソリン税率 | 税率上昇→価格上昇→需要減少 | 政策効果の測定 |
| **GDP (trillion yen)** | 兆円 | 名目GDP | 所得増加→需要増加 | 所得弾力性の測定 |

### データ項目の選定理由

#### 🔥 **必須4変数の重要性**

1. **Q (liters) - ガソリン消費量**
   - **理由**: 消費者余剰計算の被説明変数
   - **役割**: 需要の変化を直接測定

2. **P (yen/liter) - ガソリン価格**
   - **理由**: 価格弾力性の推定に必要
   - **役割**: 価格変化が需要に与える影響を定量化

3. **Tax_rate (%) - ガソリン税率**
   - **理由**: 政策変数として税制効果を測定
   - **役割**: 税制変更が消費者余剰に与える影響を分析

4. **GDP (trillion yen) - GDP**
   - **理由**: 所得効果の測定に必要
   - **役割**: 経済成長が需要に与える影響を定量化

### 需要関数の推定式（年次データ・レベルモデル版）

```
ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + γ×ln(Tax_rate) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε
```

- **α**: 所得弾力性（実質GDPの影響、α=0.962、p<0.001で有意）
- **β**: 価格弾力性（相対価格の影響、β=3.212、p=0.054で10%水準で有意）
- **γ**: 税率弾力性（税率の影響、γ=3.277、p=0.029で5%水準で有意）
- **δ1, δ2, δ3**: ダミー変数（政策イベントの影響）
- **R²=93.9%**: 先行研究の95%に近い説明力を達成

## 🔬 分析フローと結果解釈

### 分析の全体フロー

```
データ準備 → 需要関数推定 → 消費者余剰計算 → 結果解釈 → 政策提言
    ↓           ↓              ↓            ↓         ↓
4変数データ   回帰分析        台形近似計算   統計的解釈   政策効果評価
    ↓           ↓              ↓            ↓         ↓
sample_    estimate_      calculate_    print_    analyze_tax_
demand_    demand_        consumer_     summary   impact()
regression_ function()    surplus()
data.csv
```

#### **各ステップの実行ファイル・関数**

| ステップ | 実行ファイル | 実行関数 | 説明 |
|---------|-------------|----------|------|
| **データ準備** | `sample_demand_regression_data.csv` | `load_data()` | 4変数データ（Q, P, Tax_rate, GDP）の読み込み |
| **需要関数推定** | `main.py` | `estimate_demand_function()` | 回帰分析による弾力性の推定 |
| **消費者余剰計算** | `main.py` | `calculate_consumer_surplus()` | 台形近似による余剰計算 |
| **結果解釈** | `main.py` | `print_summary()` | 統計的解釈とサマリー表示 |
| **政策提言** | `main.py` | `analyze_tax_impact()` | 税制効果の分析と政策含意 |

### 1. データ準備段階

#### **実行ファイル・関数**
- **ファイル**: `sample_demand_regression_data.csv`
- **関数**: `load_data()` in `main.py`
- **処理**: データ読み込み、前処理、対数変換

#### **使用データ**
- **Q (liters)**: ガソリン消費量（被説明変数）
- **P (yen/liter)**: ガソリン価格（主要説明変数）
- **Tax_rate (%)**: ガソリン税率（政策変数）
- **GDP (trillion yen)**: GDP（所得効果変数）

#### **データ期間**
- **2004年〜2023年（20年分）**
- リーマンショック（2008年）、コロナ（2020年）を含む

### 2. 需要関数推定段階

#### **実行ファイル・関数**
- **ファイル**: `main.py`
- **関数**: `estimate_demand_function()`
- **処理**: OLS回帰分析、係数推定、統計的有意性検定

#### **推定式**
```
⊿lnQ = α×⊿lnGDP + β×⊿lnP + γ×⊿lnTax_rate + ε
```

#### **出力結果の解釈**

| 係数 | 推定値 | 意味 | 解釈 |
|------|--------|------|------|
| **所得弾力性 (α)** | 0.5608 | GDPが1%増加→消費量0.56%増加 | 所得効果は中程度 |
| **価格弾力性 (β)** | 0.0019 | 価格1%上昇→消費量0.002%増加 | 価格非弾力的（必需品） |
| **税率弾力性 (γ)** | 0.0000 | 税率変化→消費量変化なし | 全期間同じ税率のため |

#### **統計的有意性**
- **R² = 0.259**: モデルは需要変化の約26%を説明
- **F統計量 = 2.963, P値 = 0.0787**: モデル全体は10%水準で有意
- **所得弾力性のP値 = 0.093**: 10%水準で有意

### 3. 消費者余剰計算段階

#### **実行ファイル・関数**
- **ファイル**: `main.py`
- **関数**: `calculate_consumer_surplus()`
- **処理**: 台形近似による消費者余剰計算、累積計算

#### **計算手法（測定方法総論に基づく）**
1. **価格要因の寄与率計算**: `Xt+1 = β(exp(lnPt+1－lnPt)－1)／(exp(lnQt+1－lnQt)－1)`
2. **需要増加分の価格要因部分**: `Yt+1 = Xt+1 × (Qt+1－Qt)`
3. **消費者余剰増分の台形面積**: `(Qt＋Qt＋Yt+1)×(Pt－Pt+1)×1/2`

#### **出力結果の解釈**

| 指標 | 値 | 意味 | 解釈 |
|------|----|----|------|
| **総消費者余剰増分** | -3,755.81 | 20年間の累積変化 | 価格上昇により余剰減少 |
| **平均年間余剰増分** | -197.67 | 年間平均変化 | 毎年約200単位の余剰減少 |
| **価格上昇年数** | 17年/20年 | 価格上昇の頻度 | 85%の年で価格上昇 |
| **価格-余剰相関** | -0.2667 | 価格と余剰の関係 | 弱い負の相関 |

### 4. グラフ分析段階

#### **実行ファイル・関数**
- **ファイル**: `main.py`
- **関数**: `create_visualizations()`
- **処理**: 5つのグラフ作成、英語タイトル対応表出力

#### **5つのグラフとその解釈**

| グラフ名 | 英語タイトル | 解釈のポイント |
|----------|-------------|---------------|
| **価格推移** | Gasoline Price Trend | 価格上昇傾向、経済ショック時の変動 |
| **消費量推移** | Gasoline Consumption Trend | 消費量の安定性、ショック時の減少 |
| **余剰増分推移** | Consumer Surplus Increase Trend | 年次の余剰変化、価格上昇年の減少 |
| **累積余剰推移** | Cumulative Consumer Surplus Trend | 長期的な余剰変化、政策効果の持続性 |
| **価格-余剰関係** | Gasoline Price vs Consumer Surplus Relationship | 価格と余剰の散布図、相関の可視化 |

### 5. 政策含意と考察

#### **実行ファイル・関数**
- **ファイル**: `main.py`
- **関数**: `analyze_tax_impact()`, `print_summary()`
- **処理**: 税制効果分析、結果サマリー、政策含意の提示

#### **主要な発見**
1. **価格非弾力性**: ガソリンは必需品であり、価格変化に反応しにくい
2. **所得効果**: GDP成長が消費量増加に寄与
3. **消費者余剰の減少**: 価格上昇により長期的に余剰が減少
4. **政策効果の限界**: 税率固定により税制効果を測定できず

#### **政策提言**
1. **価格安定化**: 価格変動の抑制により消費者余剰を保護
2. **代替エネルギー促進**: 価格非弾力性を考慮した政策設計
3. **所得政策**: GDP成長による需要増加効果の活用

## 📊 分析手法の詳細

### 1. 対数変換の意義

```
なぜ対数を取るのか？
→ 経済学では変化率を扱いたいときに「対数の差」を使うのが一般的
→ ln(Q2) - ln(Q1) ≒ (Q2 - Q1) / Q1（≒成長率）
→ 単位の異なるデータ（Q: 百万人, GDP: 兆円）を比較可能にする
```

### 2. 回帰モデル

**変化率モデル：**
```
Δln(Q) = α * Δln(GDP) + β * Δln(P) + γ * DD + ε
```

**レベルモデル（復元後）：**
```
Q = A * GDP^α * P^β * e^(γ*DD)
```

### 3. 定数項A_tの意味

```
A_t = Q / (GDP^α * P^β * exp(γ*DD))
```

- GDP、価格、政策の影響を除いた「純粋な需要水準」
- 年ごとのA_tの推移を見ることで、外的要因を除いた基礎的な需要トレンドを把握

### 4. 消費者余剰の近似

価格弾力性εを用いた近似式：
```
CS ≈ (ε / (1 + ε)) × P × Q
```

## 📈 現状の成果

### ✅ 推定済みの指標

- **所得弾力性（α）**: GDPが1%増加したときのQ（加入者数）の変化率
- **価格弾力性（β）**: 価格が1%上昇したときのQの変化率
- **ダミー変数効果（γ）**: 政策実施による需要への影響
- **需要関数**: 上記係数を組み込んだ完全な需要関数
- **定数項の推移グラフ**: 経済要因を除いた純需要の時系列変化
- **消費者余剰の推移グラフ**: 年次ごとのCS変化

## 🔧 今後のタスク（memo.textより）

### 優先度：高

1. **消費者余剰の要因分解**
   - GDPによる増加分の算出 → グラフ・表化
   - 政策①による増加分の算出 → グラフ・表化
   - 各要因の寄与度を定量的に示す

### 優先度：中

2. **回帰分析の妥当性検証**
   - 手計算による回帰係数の再現
   - 分析手法の理論的理解の深化
   - 統計的有意性の確認（P値、R²など）

3. **説明変数の拡張検討**
   - 現在のモデルで考慮されていない要因の洗い出し
   - 追加変数候補のリストアップ
   - モデルの改善可能性の検討

## 🚀 使い方

### 必要なライブラリ

```bash
pip install pandas numpy matplotlib statsmodels
```

### 実行方法

#### 1. 年次データの対数変換準備（初回のみ、またはrawデータ更新時）
```bash
python scripts/data_preparation/07_prepare_annual_log_transformed_data.py
```

#### 2. 需要関数の推定（年次データ・レベルモデル版）
```bash
python analysis/01_estimate_demand_function_annual_level_model.py
```

#### 3. 消費者余剰の計算
```bash
python analysis/02_calculate_consumer_surplus.py
```

#### 4. 結果の可視化
```bash
python analysis/03_visualize_results.py
```

#### 出力ファイル
- **`analysis/results/01_coefficients_annual_level_model.json`** - 係数と統計指標（R²=93.9%）
- **`analysis/results/01_analysis_data_annual_level_model.csv`** - 分析用データ
- **`analysis/results/01_demand_function_coefficients_annual_level_model.csv`** - 係数結果
- **`analysis/results/02_consumer_surplus_results.csv`** - 消費者余剰計算結果
- **`analysis/figures/`** - 5つの研究用グラフ（PNG形式）

## 🔬 研究検証プロセス

### 税率データの選択に関する検証

#### 問題設定

`gasoline_tax_quarterly.csv`には複数の税率データが含まれており、需要関数の推定においてどの税率指標を使用すべきかを検証する必要がありました。

#### 利用可能な税率指標の比較

`gasoline_tax_quarterly.csv`には以下の税率列が含まれています：

| 列名 | 説明 | 消費税 | 暫定税率 | 使用例（2007Q1） |
|------|------|--------|----------|------------------|
| **実効従量税率_円L** | 消費税込みの実効税率 | 含む | 含む | 58.63円/L |
| **合計従量税率_円L** | 消費税抜きの従量税率 | 含まない | 含む | 55.84円/L |
| **合計税率_円L** | 本則+暫定（消費税抜き） | 含まない | 含む | 53.8円/L |

#### 検証結果と選択理由

**選択した指標：実効従量税率_円L**

**理由：**

1. **消費者が実際に負担する税率を正確に反映**
   - 消費税込みの実効税率であり、消費者が実際に支払う税額を反映
   - 需要関数の推定において、実際の消費者行動に影響を与える税率を測定できる

2. **既存実装との整合性**
   - `merge_all_quarterly_data.py`で既に使用されている計算方法と一致
   - 既存の分析結果との一貫性を維持

3. **政策効果の測定に適している**
   - 税制変更（消費税率変更、暫定税率変更）の影響を正確に反映
   - 2008Q2の暫定税率一時失効（ガソリン国会）など、重要な政策イベントを正確に捉えられる

#### 計算方法

```python
Tax_rate (%) = (実効従量税率_円L / P (yen/liter)) * 100
```

**計算例（2007Q1）：**
- 実効従量税率: 58.63円/L
- 価格: 130.8円/L
- Tax_rate: 58.63 / 130.8 * 100 = 44.82%

#### 実装上の考慮事項

1. **価格データがない期間の処理**
   - 1950-1990年など、価格データが存在しない期間については、実効従量税率（円/L）を保存
   - 価格データが利用可能になった時点で、価格と組み合わせて%を計算

2. **データ期間の拡張**
   - 1950年Q1から2025年Q4までの全期間の税率データを追加
   - 需要関数の推定において、より長期的な税制効果を分析可能に

#### 検証プロセスの記録

この検証プロセスにより、以下の点が明確になりました：

- **理論的妥当性**: 消費者が実際に負担する税率を使用することで、需要関数の推定精度が向上
- **実装の一貫性**: 既存のコードベースとの整合性を維持
- **政策分析の精度**: 税制変更の影響を正確に測定可能

#### 今後の検証課題

1. **代替指標との比較検証**: 合計従量税率や合計税率を使用した場合の推定結果との比較
2. **感度分析**: 異なる税率指標を使用した場合の弾力性推定値への影響
3. **期間別分析**: 消費税導入前後での税率指標の影響の違い

## 📚 技術スタック

- **Python 3.x**
- **pandas**: データ処理
- **numpy**: 数値計算
- **matplotlib**: グラフ描画
- **statsmodels**: 回帰分析（OLS: Ordinary Least Squares）

## 📝 注意事項

- 分析データのファイルパスは各自の環境に合わせて変更してください
- 対数差分により最初の年（2004年）のデータは除外されます
- ガソリン税率は全期間53.8%で固定（税制変更効果の測定は限定的）
- グラフは英語表記で出力されます（日本語フォントエラー回避）

## 🎯 今後の課題

### 優先度：高
1. **税制変更データの追加**: 実際の税率変更年を含むデータで分析
2. **代替エネルギー要因の考慮**: 電気自動車普及等の影響分析
3. **地域別分析**: 都道府県別のガソリン需要分析

### 優先度：中
4. **季節変動の考慮**: 四半期データによる季節調整
5. **価格予測モデル**: 将来の消費者余剰予測
6. **政策シミュレーション**: 税率変更シナリオの分析

---

**作成日**: 2025年10月29日  
**分析対象期間**: 2004年〜2023年（20年分）  
**プロジェクトステータス**: 完成 🎉


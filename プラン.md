# ガソリン税による消費者余剰分析プロジェクト - 次以降のプラン

## 現状のデータ状況

### データの欠損状況（demand_regression_data_raw.csv）

| 変数 | データ期間 | 欠損率 | 備考 |
|------|-----------|--------|------|
| **Q (liters)** | 2007Q1-2025Q1（一部欠損） | 約66% | **最重要：被説明変数** ✅ 2015Q2-2018Q4, 2020Q2-2023Q4を補完済み |
| **P (yen/liter)** | 1990Q3-2025Q1 | 約54% | 価格データは比較的充実 |
| **Tax_rate (%)** | 1990Q3-2025Q1 | 約54% | 税率データは比較的充実 |
| **GDP (trillion yen)** | 1994Q1-2025Q1 | 約59% | GDPデータは比較的充実 |

### 全変数が揃っている期間

- **2007Q1-2025Q1**: 一部の四半期でQ (liters)が欠損
- **補完済み期間**:
  - ✅ 2015Q2-2018Q4: Q (liters)を補完済み（`02_complete_consumption_data.py`で実行）
  - ✅ 2020Q2-2023Q4: Q (liters)を補完済み（`02_complete_consumption_data.py`で実行）
  - ✅ 2014Q2以降の単位を統一済み（10億リットル単位、`03_fix_units.py`で実行）
- **残りの欠損期間**:
  - 2010年: Q (liters)が完全に欠損（4四半期）

## 分析に必要なデータ（優先順位順）

### 🔥 最優先：Q (liters) の補完

**理由**: 被説明変数であり、需要関数の推定と消費者余剰の計算に必須

**不足しているデータ**:
1. ✅ **2015Q2-2018Q4（15四半期）**: **補完済み**
   - `02_complete_consumption_data.py`で`data/2007-2024ガソリン販売量/四半期データ_まとめ.csv`からマージ完了
   - 単位も10億リットル単位に統一済み

2. ✅ **2020Q2-2023Q4（15四半期）**: **補完済み**
   - `02_complete_consumption_data.py`で`data/2007-2024ガソリン販売量/四半期データ_まとめ.csv`からマージ完了
   - 単位も10億リットル単位に統一済み

3. ✅ **2014Q2以降の単位統一**: **完了**
   - `03_fix_units.py`で2014Q2以降のデータを10億リットル単位に統一
   - 2014Q2: 12737588 → 12737588000（1000倍）

4. **2010年（4四半期）**: 完全に欠損（残りのタスク）
   - 2010Q1, 2010Q2, 2010Q3, 2010Q4
   - データソース: 経済産業省のガソリン販売量データから取得が必要

### 📊 優先度：高 - 1994Q1-2006Q4のQ (liters)データ

**理由**: GDPデータが存在する期間（1994Q1以降）で、より長期的な分析が可能になる

**不足しているデータ**:
- 1994Q1-2006Q4（52四半期、13年分）
- この期間のデータがあれば、分析期間を1994Q1-2025Q1（約31年）に拡張可能
- **データソース**: 経済産業省のガソリン販売量データから取得が必要

### 📈 優先度：中 - 1990Q3-1993Q4のQ (liters)データ

**理由**: 価格・税率データが存在する期間で、分析期間をさらに拡張可能

**不足しているデータ**:
- 1990Q3-1993Q4（14四半期、約3.5年分）
- **データソース**: 経済産業省のガソリン販売量データから取得が必要

## データ保管・整理の推奨事項

### 1. 既存データの補完（✅ 完了）

#### ✅ スクリプト作成・実行完了: `02_complete_consumption_data.py`
- `data/2007-2024ガソリン販売量/四半期データ_まとめ.csv`から欠損しているQ (liters)データをマージ
- 対象期間: 2015Q2-2018Q4, 2020Q2-2023Q4
- **結果**: 30行のデータを補完

#### ✅ 単位統一スクリプト作成・実行完了: `03_fix_units.py`
- 2014Q2以降のデータを10億リットル単位に統一
- **結果**: 44行のデータの単位を統一（1000倍変換）

#### 実行済み手順:
1. ✅ `data/2007-2024ガソリン販売量/四半期データ_まとめ.csv`を読み込み
2. ✅ Year, Quarter列からYearQuarter形式（例: 2015Q2）を作成
3. ✅ `demand_regression_data_raw.csv`とマージ
4. ✅ 欠損しているQ (liters)を補完（30行）
5. ✅ データの単位を統一（2014Q2以降を10億リットル単位に変換）

### 2. 外部データの収集（中期的なタスク）

#### 2010年のデータ収集
- **データソース**: 経済産業省「資源エネルギー統計」
- **URL**: https://www.enecho.meti.go.jp/statistics/
- **取得方法**: ガソリン販売量の四半期データをダウンロード

#### 1994Q1-2006Q4のデータ収集
- **データソース**: 経済産業省「資源エネルギー統計」
- **取得方法**: ガソリン販売量の四半期データをダウンロード
- **重要性**: 分析期間を約31年に拡張可能

#### 1990Q3-1993Q4のデータ収集
- **データソース**: 経済産業省「資源エネルギー統計」
- **取得方法**: ガソリン販売量の四半期データをダウンロード
- **重要性**: 分析期間を約35年に拡張可能

### 3. データ品質の確認

#### ✅ 単位の統一（完了）
- Q (liters): 10億リットル単位で統一済み
  - 2007Q1-2014Q1: 既に10億リットル単位
  - 2014Q2以降: `03_fix_units.py`で10億リットル単位に変換済み
- データの整合性チェック: 異常値の検出と修正（今後のタスク）

#### 欠損値の処理方針
- 連続した期間の欠損: 補間または除外
- 孤立した欠損: 前後のデータから補間
- **残りの欠損**: 2010年（4四半期）のみ

## 分析可能期間の見通し

### 現状（データ補完後）
- **最小期間**: 2007Q1-2025Q1（約18年、72四半期）
  - ✅ 2015Q2-2018Q4, 2020Q2-2023Q4を補完済み
  - ⚠️ 2010年（4四半期）が欠損
- **最大期間**: 1994Q1-2025Q1（約31年、124四半期）※1994-2006年のQデータ取得後

### 理想的な状況（全データ取得後）
- **最大期間**: 1990Q3-2025Q1（約35年、139四半期）

## 次のステップ（優先順位順）

### Phase 1: 既存データの補完（✅ 完了）
1. ✅ `02_complete_consumption_data.py`の作成・実行
2. ✅ 2015Q2-2018Q4, 2020Q2-2023Q4のQ (liters)データをマージ（30行補完）
3. ✅ `03_fix_units.py`の作成・実行
4. ✅ 2014Q2以降のデータ単位を統一（10億リットル単位、44行変換）
5. ⏳ データ品質チェックスクリプトの作成（今後のタスク）

### Phase 2: 外部データの収集（進行中）
1. ⏳ 2010年のQ (liters)データを収集（4四半期、最優先）
2. ⏳ 1994Q1-2006Q4のQ (liters)データを収集（52四半期、分析期間拡張に重要）
3. ⏳ データを`demand_regression_data_raw.csv`に追加

### Phase 3: 分析の実行（データ補完後）
1. 需要関数の推定（⊿lnQ = α×⊿lnGDP + β×⊿lnP + γ×⊿lnTax_rate + ε）
2. 消費者余剰の計算（測定方法総論に基づく台形近似）
3. 要因分解（GDP、価格、税率の寄与度）
4. 政策イベントの影響分析（2008Q2暫定税率失効など）

## データ保管の推奨構造

```
data/
├── 2007-2024ガソリン販売量/
│   └── 四半期データ_まとめ.csv  # 既存データ（マージ対象）
├── 1994-2025_GDP四半期ごと/
│   └── gaku-jg2522.csv  # GDPデータ（既に統合済み）
├── 1990-2025_ガソリン小売価格四半期ごと/
│   └── 1990-2025レギュラー現金価格.csv  # 価格データ（既に統合済み）
├── -2025ガソリン関連税四半期ごと/
│   └── gasoline_tax_quarterly.csv  # 税率データ（既に統合済み）
└── 追加収集データ/
    ├── 2010年ガソリン販売量.csv  # 新規収集
    ├── 1994-2006年ガソリン販売量.csv  # 新規収集
    └── 1990-1993年ガソリン販売量.csv  # 新規収集（オプション）
```

## まとめ

**特に保管すべきデータ（優先順位）**:

1. **Q (liters)の補完データ**（✅ 一部完了）
   - ✅ 2015Q2-2018Q4, 2020Q2-2023Q4: 既存ファイルからマージ完了（30行）
   - ⏳ 2010年: 外部データ収集が必要（4四半期、残りのタスク）
   - ⏳ 1994Q1-2006Q4: 外部データ収集が必要（52四半期、分析期間拡張に重要）

2. **データ品質の確認**（✅ 単位統一完了）
   - ✅ 単位の統一（10億リットル単位で統一済み）
   - ⏳ 異常値の検出と修正（今後のタスク）

3. **データの整合性チェック**
   - 連続性の確認
   - 欠損パターンの分析

**分析しやすくするための推奨事項**:
- ✅ 既存データ（`data/2007-2024ガソリン販売量/四半期データ_まとめ.csv`）から欠損を補完完了
- ⏳ 外部データ（2010年、1994-2006年）を収集（次のステップ）
- ⏳ 全変数が揃っている期間を最大化することで、より信頼性の高い分析が可能

## 更新履歴

- **2025年11月25日**: Phase 1完了
  - `02_complete_consumption_data.py`で2015Q2-2018Q4, 2020Q2-2023Q4のQ (liters)データを補完（30行）
  - `03_fix_units.py`で2014Q2以降のデータ単位を統一（10億リットル単位、44行変換）
  - 全変数が揃っている期間: 2007Q1-2025Q1（2010年を除く、約72四半期）


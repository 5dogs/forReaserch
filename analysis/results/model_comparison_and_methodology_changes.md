# モデル修正：税率変数除外による変更点まとめ

## 1. モデル仕様の変更

### 1.1 修正前のモデル（現在のモデル）

**推定式：**
```
ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + γ×ln(Tax_rate) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε
```

**説明変数：**
- ln(GDP): 実質GDPの対数
- ln(P_relative): 相対価格の対数（名目価格/CPI）
- ln(Tax_rate): 実効従量税率の対数
- D2008: 2008年暫定税率失効ダミー
- D2020: 2020年COVID-19ダミー
- D2009: 2009年金融危機ダミー

### 1.2 修正後のモデル（税率除外）

**推定式：**
```
ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε
```

**説明変数：**
- ln(GDP): 実質GDPの対数
- ln(P_relative): 相対価格の対数（名目価格/CPI）
- ~~ln(Tax_rate): 実効従量税率の対数~~ ← **除外**
- D2008: 2008年暫定税率失効ダミー
- D2020: 2020年COVID-19ダミー
- D2009: 2009年金融危機ダミー

**変更理由：**
- `ln_P_relative` と `ln_Tax_rate` の相関係数が **-0.9671** と極めて強い負の相関
- VIF値が異常に高い（ln_Tax_rate: 6,447.85）
- 多重共線性により係数の推定が不安定になり、符号が理論と矛盾
- 相対価格には既に税の影響が含まれているため、理論的にも除外は妥当

---

## 2. 推定結果の比較

### 2.1 係数の比較

| 変数 | 修正前（税率含む） | 修正後（税率除外） | 変化の説明 |
|------|------------------|------------------|-----------|
| **所得弾力性 (α)** | 0.9527<br>(p<0.001, ***) | **要再計算**<br>（予想：0.8-1.2程度） | 理論的には正の値で1に近い値が期待される |
| **価格弾力性 (β)** | 3.7623<br>(p=0.008, **) | **要再計算**<br>（予想：-0.3～-0.8程度） | **符号が負になることが期待される**<br>（価格上昇→需要減少） |
| **税率弾力性 (γ)** | 2.2638<br>(p=0.004, **) | **除外** | 変数自体を除外 |
| **定数項 (C)** | 7.6357<br>(p=0.018, *) | **要再計算** | モデル構造の変化により変動 |
| **D2008** | 0.4558<br>(p=0.004, **) | **要再計算** | 係数の大きさが変わる可能性 |
| **D2020** | -0.2234<br>(p=0.060, *) | **要再計算** | 係数の大きさが変わる可能性 |
| **D2009** | 0.1367<br>(p=0.268, 非有意) | **要再計算** | 係数の大きさが変わる可能性 |

### 2.2 モデル適合度の比較

| 指標 | 修正前（税率含む） | 修正後（税率除外） | 変化の予想 |
|------|------------------|------------------|-----------|
| **R²** | 0.9559 (95.59%) | **要再計算**<br>（予想：0.85-0.95程度） | やや低下する可能性（変数が1つ減るため） |
| **調整済みR²** | 0.9339 (93.39%) | **要再計算**<br>（予想：0.80-0.90程度） | 自由度の増加により、低下幅は小さい可能性 |
| **F統計量のP値** | 1.90×10⁻⁷ | **要再計算** | 依然として有意であることが期待される |

### 2.3 多重共線性の改善

| 変数 | 修正前のVIF値 | 修正後のVIF値（予想） | 改善 |
|------|-------------|---------------------|------|
| **ln_GDP** | 8,878.21 | **要再計算**<br>（予想：10-50程度） | **大幅改善** |
| **ln_P_relative** | 229.36 | **要再計算**<br>（予想：5-20程度） | **大幅改善** |
| **ln_Tax_rate** | 6,447.85 | **除外** | **完全に解消** |
| **D2008** | 1.31 | **要再計算**<br>（予想：1.0-2.0程度） | ほぼ変化なし |
| **D2020** | 1.16 | **要再計算**<br>（予想：1.0-2.0程度） | ほぼ変化なし |
| **D2009** | 1.47 | **要再計算**<br>（予想：1.0-2.0程度） | ほぼ変化なし |

**期待される改善：**
- すべてのVIF値が10以下になることが期待される
- 係数の推定が安定し、符号が理論と一致することが期待される

### 2.4 なぜ相対価格の係数（β）も正になったのか

**原因：多重共線性による係数の相互干渉**

相対価格と税率が極めて強い負の相関（-0.9671）を持っているため、回帰分析は両方の変数の効果を正しく分離できません。

**具体例：**
- 相対価格が**高い**時 → 税率は**低い**（逆方向に動く）
- 相対価格が**低い**時 → 税率は**高い**（逆方向に動く）

回帰分析は以下のように「誤解」します：
- 「相対価格が高い時、税率は低い。そして需要は減少している」
- 「相対価格が低い時、税率は高い。そして需要は増加している」
- → 相対価格と税率が逆方向に動くため、**両方の係数（βとγ）の符号を同じ方向（正）にして「バランスを取る」**

**結果：**
- 単独では相対価格と需要は負の相関（-0.1536）で正しい
- しかし、税率を同時に入れると、多重共線性により**相対価格の係数（β）も正の値になってしまう**

**解決策：**
税率を除外することで、相対価格の係数（β）が負の値になり、理論と一致します。

---

## 3. 分析手法の変更点

### 3.1 データ準備段階

**変更なし：**
- データ収集方法（GDP、価格、CPI、消費量）
- 年次データへの集約方法
- 対数変換の方法

**変更点：**
- ~~Tax_rateデータの収集・集約~~ ← **不要になる**
- データ説明からTax_rateの記述を削除

### 3.2 回帰分析段階

**変更点：**

1. **説明変数の選択**
   - **修正前：** ln_GDP, ln_P_relative, ln_Tax_rate, D2008, D2020, D2009
   - **修正後：** ln_GDP, ln_P_relative, D2008, D2020, D2009

2. **多重共線性の診断**
   - **修正前：** VIF値が異常に高いが、そのまま使用
   - **修正後：** 税率を除外することで多重共線性を解消
   - VIF値の再計算と確認が必要

3. **係数の解釈**
   - **修正前：** βとγの符号が理論と矛盾（正の値）
   - **修正後：** βが負の値になることが期待される（理論と一致）

4. **モデル選択の根拠**
   - **修正前：** 先行研究に合わせて税率を含めた
   - **修正後：** 多重共線性の問題を解決するため税率を除外
   - 相対価格に税の影響が既に含まれているという理論的根拠を追加

### 3.3 消費者余剰計算段階

**変更なし：**
- 台形近似法による計算方法
- 価格弾力性（β）を使用する計算式
- ただし、**βの値が変わるため、結果も変わる**

**注意点：**
- 修正後のβ値（負の値）を使用して再計算が必要
- 消費者余剰の増分や累積値が変わる可能性

### 3.4 CPI寄与度分析

**変更なし：**
- CPI寄与度分析の手法
- 従量税・従価税の比較分析
- これらの分析は税率変数とは独立している

### 3.5 可視化

**変更点：**
- 図1（需要関数の係数）：税率弾力性（γ）の棒グラフを削除
- その他の図表：基本的に変更なし

---

## 4. 論文記載の修正箇所

### 4.1 要約部分

**修正前：**
> 実質GDP・相対価格・税率に加え、2008年暫定税率失効、2009年金融危機、2020年COVID-19の各イベントを考慮した対数を使ったモデル（ログレベルモデル）を推定した結果、R²=95.6%となった。推定結果として、所得弾力性（α=0.9527、p<0.001）、価格弾力性（β=3.7623、p=0.008）、税率弾力性（γ=2.2638、p=0.004）がいずれも統計的に有意となった。

**修正後：**
> 実質GDP・相対価格に加え、2008年暫定税率失効、2009年金融危機、2020年COVID-19の各イベントを考慮した対数を使ったモデル（ログレベルモデル）を推定した結果、R²=XX.X%となった。推定結果として、所得弾力性（α=XX.XX、p<X.XXX）、価格弾力性（β=-X.XX、p<X.XXX）がいずれも統計的に有意となった。なお、当初の分析では税率（Tax_rate）も説明変数として含めていたが、相対価格（P_relative）と税率（Tax_rate）の間に極めて強い負の相関（相関係数-0.9671）が観測され、多重共線性の問題が発生したため、最終的なモデルからは税率を除外した。相対価格には既に税の影響が含まれていることから、この除外は理論的にも妥当である。

### 4.2 推定式の記載

**修正前：**
```
ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + γ×ln(Tax_rate) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε
```

**修正後：**
```
ln(Q) = C + α×ln(GDP) + β×ln(P_relative) + δ1×D2008 + δ2×D2020 + δ3×D2009 + ε
```

### 4.3 変数の説明

**削除：**
- Tax_rateの変数説明（119行目付近）

**修正：**
- データ収集の説明から「ガソリン税率（Tax_rate）は...」の記述を削除
- 「価格・税率・CPIは年間平均」→「価格・CPIは年間平均」

### 4.4 図表の説明

**図1の修正：**
- 「所得弾力性、価格弾力性、税率弾力性」→「所得弾力性、価格弾力性」
- 税率弾力性に関する説明を削除
- 係数の値と符号を修正後の結果に更新

### 4.5 実証分析結果の記載

**修正前：**
> 税率弾力性（γ）は2.2638（p=0.004、1%水準で有意）と推定され、価格弾力性より小さな値である。これは、税率の変動が価格の変動ほど需要に大きな影響を与えないことを示しており、ガソリン税制が需要構造に与える影響の大きさを裏付けている。

**修正後：**
> （削除）なお、当初の分析では税率も説明変数として含めていたが、相対価格と税率の間に極めて強い負の相関（-0.9671）が観測され、多重共線性の問題が発生したため、最終的なモデルからは税率を除外した。相対価格には既に税の影響が含まれていることから、この除外は理論的にも妥当である。

### 4.6 考察部分

**修正前：**
> 価格弾力性と税率弾力性がともに3を超える大きな値であることから、価格や税率の変動が需要に大きな影響を与えることがわかった。

**修正後：**
> 価格弾力性がX.XX（絶対値）と大きな値であることから、価格の変動が需要に大きな影響を与えることがわかった。

---

## 5. 修正後の分析手順

### Step 1: 回帰分析の再実行

1. `01_estimate_demand_function_annual_level_model.py` を修正
   - `ln_Tax_rate` を説明変数から除外
   - 推定式を更新

2. 回帰分析を実行
   - 新しい係数を取得
   - R²、調整済みR²、F統計量を確認
   - VIF値を再計算して多重共線性の解消を確認

### Step 2: 結果の確認

1. **係数の符号確認**
   - β（価格弾力性）が負の値になっているか確認
   - α（所得弾力性）が正の値で1に近いか確認

2. **統計的有意性の確認**
   - 各係数のP値を確認
   - モデル全体のF統計量を確認

3. **多重共線性の確認**
   - VIF値がすべて10以下になっているか確認
   - 相関マトリックスを再確認

### Step 3: 消費者余剰の再計算

1. `02_calculate_consumer_surplus.py` を修正
   - 新しいβ値を使用
   - 消費者余剰の増分と累積値を再計算

2. 結果の確認
   - 消費者余剰の値が理論的に妥当か確認
   - 価格と余剰の相関を再確認

### Step 4: 論文の修正

1. 上記4章の修正箇所に従って論文を更新
2. 新しい係数値とR²値を反映
3. 多重共線性の問題と税率除外の理由を追加説明

---

## 6. 期待される改善点

### 6.1 理論的整合性の向上

- **修正前：** βとγが正の値（理論と矛盾）
- **修正後：** βが負の値になることが期待される（理論と一致）

### 6.2 多重共線性の解消

- **修正前：** VIF値が数千という異常値
- **修正後：** すべてのVIF値が10以下になることが期待される

### 6.3 係数推定の安定化

- **修正前：** 多重共線性により係数の推定が不安定
- **修正後：** 係数の推定が安定し、解釈が容易になる

### 6.4 モデルの簡潔性

- **修正前：** 3つの主要説明変数（GDP、価格、税率）
- **修正後：** 2つの主要説明変数（GDP、価格）
- モデルが簡潔になり、解釈が容易になる

---

## 7. 注意事項

### 7.1 再計算が必要な項目

- すべての係数（α、β、C、ダミー変数の係数）
- R²、調整済みR²
- F統計量とそのP値
- VIF値
- 消費者余剰の増分と累積値
- 価格と余剰の相関係数

### 7.2 変更不要な項目

- CPI寄与度分析の結果
- 従量税・従価税の比較分析
- データ収集方法の説明
- ダミー変数の選定理由

### 7.3 追加説明が必要な項目

- 税率を除外した理由（多重共線性の問題）
- 相対価格に税の影響が含まれているという理論的根拠
- 修正前後のモデル適合度の比較（もしR²が大きく低下した場合）

---

## 8. 次のステップ

1. **回帰分析の再実行**
   - 税率を除外したモデルで回帰分析を実行
   - 新しい係数と統計量を取得

2. **結果の検証**
   - 係数の符号が理論と一致しているか確認
   - VIF値が改善されているか確認
   - モデル適合度が許容範囲内か確認

3. **消費者余剰の再計算**
   - 新しいβ値を使用して消費者余剰を再計算

4. **論文の修正**
   - 上記の修正箇所に従って論文を更新
   - 新しい結果を反映

5. **教授への説明準備**
   - 多重共線性の問題とその解決策を説明
   - 修正前後の比較を提示
   - 理論的整合性の向上を強調

